---
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";

// 1. 获取当前路由的 slug 参数
const { slug } = Astro.params;

// 2. 使用 import.meta.glob 导入所有博客文章（路径不能加 `/src` 开头）
const postModules = import.meta.glob("../../content/blog/*.md");

// 3. 构造文件路径
const path = `../../content/blog/${slug}.md`;

// 4. 检查路径是否存在，避免 404 报错
if (!(path in postModules)) {
  throw new Error(`未找到文章：${slug}`);
}
console.log(Object.keys(postModules));
// 5. 动态导入对应的 Markdown 文件模块
const mod = await postModules[path]();

// 6. 拿到内容组件和前置数据
const { default: Content, frontmatter } = mod;
---

<html lang="zh-CN">
  <head>
    <title>{frontmatter.title}</title>
  </head>
  <body>
    <Header />
    <main style="max-width: 800px; margin: auto; padding: 2rem;">
      <h1 style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">
        {frontmatter.title}
      </h1>
      <p style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 1.5rem;">
        📅 {
          new Date(frontmatter.pubDate).toLocaleDateString("zh-CN", {
            year: "numeric",
            month: "long",
            day: "numeric",
          })
        }
      </p>
      <article class="prose prose-invert">
        <Content />
      </article>
    </main>
    <Footer />
  </body>
</html>
