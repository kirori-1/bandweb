---
import { getEntry, getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import { AstroError } from "astro/errors";

// â›“ï¸ Step 1: å‘Šè¯‰ Astro æ‰€æœ‰æ–‡ç«  slug
export async function getStaticPaths() {
  const posts = await getCollection("blog");

  return posts.map((post: any) => ({
  params: { slug: post.slug },
  props: { slug: post.slug },
}));

}

// ğŸ§  Step 2: æ ¹æ® slug è·å–æ–‡ç« 
const { slug } = Astro.props;
const entry = await getEntry("blog", slug);
console.log("ğŸ§  Slug:", slug);
if (!entry) {
  throw new AstroError(`æœªæ‰¾åˆ°æ–‡ç« ï¼š${slug}`);
}

const { Content, data } = await entry.render();
---

<html lang="zh-CN">
  <head>
    <BaseHead title={data.title} description={data.excerpt ?? ""} />
  </head>
  <body>
    <Header />
    <main style="max-width: 800px; margin: auto; padding: 2rem;">
      <h1>{data.title}</h1>
      <p style="color: #06b6d4;">
        {
          data.pubDate?.toLocaleDateString("zh-CN", {
            year: "numeric",
            month: "long",
            day: "numeric",
          }) ?? "æ²¡æœ‰å‘å¸ƒæ—¥æœŸ"
        }
      </p>
      <Content />
    </main>
    <Footer />
  </body>
</html>
