---
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";

// 1. è·å–å½“å‰è·¯ç”±çš„ slug å‚æ•°
const { slug } = Astro.params;

// 2. ä½¿ç”¨ import.meta.glob å¯¼å…¥æ‰€æœ‰åšå®¢æ–‡ç« ï¼ˆè·¯å¾„ä¸èƒ½åŠ  `/src` å¼€å¤´ï¼‰
const postModules = import.meta.glob("../../content/blog/*.md");

// 3. æ„é€ æ–‡ä»¶è·¯å¾„
const path = `../../content/blog/${slug}.md`;

// 4. æ£€æŸ¥è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œé¿å… 404 æŠ¥é”™
if (!(path in postModules)) {
  throw new Error(`æœªæ‰¾åˆ°æ–‡ç« ï¼š${slug}`);
}
console.log(Object.keys(postModules));
// 5. åŠ¨æ€å¯¼å…¥å¯¹åº”çš„ Markdown æ–‡ä»¶æ¨¡å—
const mod = await postModules[path]();

// 6. æ‹¿åˆ°å†…å®¹ç»„ä»¶å’Œå‰ç½®æ•°æ®
const { default: Content, frontmatter } = mod;
---

<html lang="zh-CN">
  <head>
    <title>{frontmatter.title}</title>
  </head>
  <body>
    <Header />
    <main style="max-width: 800px; margin: auto; padding: 2rem;">
      <h1 style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">
        {frontmatter.title}
      </h1>
      <p style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 1.5rem;">
        ğŸ“… {
          new Date(frontmatter.pubDate).toLocaleDateString("zh-CN", {
            year: "numeric",
            month: "long",
            day: "numeric",
          })
        }
      </p>
      <article class="prose prose-invert">
        <Content />
      </article>
    </main>
    <Footer />
  </body>
</html>
